import{_ as S,r as i,k as B,l as N,c as r,b as e,j as C,g as M,t as a,f as p,v as U,x as $,F as R,n as T,e as j,D as x,o as d,s as G}from"./index-DYB-CqZx.js";const q={class:"users-page"},P={class:"page-header"},Q={class:"stats-row"},Y={class:"stat-card"},J={class:"stat-content"},K={class:"stat-value"},O={class:"stat-card"},W={class:"stat-content"},X={class:"stat-value"},Z={class:"stat-card"},ee={class:"stat-content"},te={class:"stat-value"},se={class:"stat-card"},le={class:"stat-content"},oe={class:"stat-value"},ne={class:"controls-section"},ae={class:"search-bar"},ie={key:0,class:"loading-container"},re={key:1,class:"error-container"},de={key:2,class:"users-table-container"},ue={class:"users-table"},ve={class:"user-cell"},me={class:"user-avatar"},ce={class:"user-info"},pe={class:"user-name"},ke={class:"user-id"},fe={class:"user-email"},ge={class:"user-date"},be={class:"action-buttons"},he=["onClick"],we=["onClick","disabled"],ye={key:0,class:"empty-state"},Ce={class:"modal-header"},Me={class:"modal-body"},Ue={class:"form-group"},xe={class:"form-group"},_e={class:"form-group"},Ae={class:"modal-footer"},Be={class:"modal-header"},$e={class:"modal-body"},je={class:"modal-footer"},ze={__name:"Users",setup(De){const w="https://masqani-api-ug5fk2kuxq-uc.a.run.app",o=i([]),y=i(!0),k=i(""),f=i(""),g=i("all"),v=i(!1),m=i(!1),z=i(!1),c=i(null),n=i({id:null,full_name:"",email:"",role:"guest"}),b=B(()=>({guest:o.value.filter(s=>s.role==="guest").length,host:o.value.filter(s=>s.role==="host").length,admin:o.value.filter(s=>s.role==="admin").length})),_=B(()=>{let s=[...o.value];if(f.value.trim()){const t=f.value.toLowerCase();s=s.filter(u=>{var l,h;return((l=u.full_name)==null?void 0:l.toLowerCase().includes(t))||((h=u.email)==null?void 0:h.toLowerCase().includes(t))})}return g.value!=="all"&&(s=s.filter(t=>t.role===g.value)),s}),A=async()=>{try{y.value=!0,k.value="";const s=localStorage.getItem("token"),t=await x.get(`${w}/api/admin/users`,{headers:{Authorization:`Bearer ${s}`}});o.value=t.data||[]}catch(s){console.error("Failed to fetch users:",s),k.value="Failed to load users. You may not have admin permissions.",o.value=[]}finally{y.value=!1}},D=s=>{n.value={id:s.id,full_name:s.full_name||"",email:s.email,role:s.role},v.value=!0},L=async()=>{try{const s=localStorage.getItem("token");await x.put(`${w}/api/admin/users/${n.value.id}`,{full_name:n.value.full_name,role:n.value.role},{headers:{Authorization:`Bearer ${s}`}});const t=o.value.findIndex(u=>u.id===n.value.id);t!==-1&&(o.value[t]={...o.value[t],...n.value}),v.value=!1}catch(s){console.error("Failed to update user:",s),alert("Failed to update user. Please try again.")}},F=s=>{c.value=s,m.value=!0},H=async()=>{try{const s=localStorage.getItem("token");await x.delete(`${w}/api/admin/users/${c.value.id}`,{headers:{Authorization:`Bearer ${s}`}}),o.value=o.value.filter(t=>t.id!==c.value.id),m.value=!1,c.value=null}catch(s){console.error("Failed to delete user:",s),alert("Failed to delete user. Please try again.")}},V=s=>s?s.split(" ").map(t=>t[0]).join("").toUpperCase().substring(0,2):"U",E=s=>({guest:"Guest",host:"Host",admin:"Admin"})[s]||s,I=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return N(()=>{A()}),(s,t)=>{var u;return d(),r("div",q,[e("div",P,[t[15]||(t[15]=e("div",null,[e("h1",null,"User Management"),e("p",{class:"subtitle"},"Manage all platform users and permissions")],-1)),e("button",{onClick:t[0]||(t[0]=l=>z.value=!0),class:"btn-add"},[...t[14]||(t[14]=[e("svg",{class:"icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),M(" Add New User ",-1)])])]),e("div",Q,[e("div",Y,[t[17]||(t[17]=e("div",{class:"stat-icon stat-icon-blue"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})])],-1)),e("div",J,[t[16]||(t[16]=e("p",{class:"stat-label"},"Total Users",-1)),e("p",K,a(o.value.length),1)])]),e("div",O,[t[19]||(t[19]=e("div",{class:"stat-icon stat-icon-green"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})])],-1)),e("div",W,[t[18]||(t[18]=e("p",{class:"stat-label"},"Guests",-1)),e("p",X,a(b.value.guest),1)])]),e("div",Z,[t[21]||(t[21]=e("div",{class:"stat-icon stat-icon-teal"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})])],-1)),e("div",ee,[t[20]||(t[20]=e("p",{class:"stat-label"},"Hosts",-1)),e("p",te,a(b.value.host),1)])]),e("div",se,[t[23]||(t[23]=e("div",{class:"stat-icon stat-icon-gold"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})])],-1)),e("div",le,[t[22]||(t[22]=e("p",{class:"stat-label"},"Admins",-1)),e("p",oe,a(b.value.admin),1)])])]),e("div",ne,[e("div",ae,[t[24]||(t[24]=e("svg",{class:"search-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>f.value=l),type:"text",placeholder:"Search by name, email...",class:"search-input"},null,512),[[U,f.value]])]),p(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>g.value=l),class:"filter-select"},[...t[25]||(t[25]=[e("option",{value:"all"},"All Roles",-1),e("option",{value:"guest"},"Guests",-1),e("option",{value:"host"},"Hosts",-1),e("option",{value:"admin"},"Admins",-1)])],512),[[$,g.value]])]),y.value?(d(),r("div",ie,[...t[26]||(t[26]=[e("div",{class:"spinner-large"},null,-1),e("p",null,"Loading users...",-1)])])):k.value?(d(),r("div",re,[t[27]||(t[27]=e("svg",{class:"error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("p",null,a(k.value),1),e("button",{onClick:A,class:"btn-retry"},"Try Again")])):(d(),r("div",de,[e("table",ue,[t[30]||(t[30]=e("thead",null,[e("tr",null,[e("th",null,"User"),e("th",null,"Email"),e("th",null,"Role"),e("th",null,"Created"),e("th",null,"Actions")])],-1)),e("tbody",null,[(d(!0),r(R,null,T(_.value,l=>(d(),r("tr",{key:l.id,class:"user-row"},[e("td",null,[e("div",ve,[e("div",me,a(V(l.full_name)),1),e("div",ce,[e("p",pe,a(l.full_name||"Unknown"),1),e("p",ke,"ID: "+a(l.id),1)])])]),e("td",null,[e("span",fe,a(l.email),1)]),e("td",null,[e("span",{class:G(["role-badge",`role-${l.role}`])},a(E(l.role)),3)]),e("td",null,[e("span",ge,a(I(l.created_at)),1)]),e("td",null,[e("div",be,[e("button",{onClick:h=>D(l),class:"btn-action btn-edit",title:"Edit User"},[...t[28]||(t[28]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,he),e("button",{onClick:h=>F(l),class:"btn-action btn-delete",title:"Delete User",disabled:l.role==="admin"&&b.value.admin<=1},[...t[29]||(t[29]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,we)])])]))),128))])]),_.value.length===0?(d(),r("div",ye,[...t[31]||(t[31]=[e("p",null,"No users found matching your search criteria.",-1)])])):C("",!0)])),v.value?(d(),r("div",{key:3,class:"modal-overlay",onClick:t[9]||(t[9]=l=>v.value=!1)},[e("div",{class:"modal",onClick:t[8]||(t[8]=j(()=>{},["stop"]))},[e("div",Ce,[t[33]||(t[33]=e("h3",null,"Edit User",-1)),e("button",{onClick:t[3]||(t[3]=l=>v.value=!1),class:"modal-close"},[...t[32]||(t[32]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Me,[e("div",Ue,[t[34]||(t[34]=e("label",{class:"form-label"},"Full Name",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>n.value.full_name=l),type:"text",class:"form-input",placeholder:"Enter full name"},null,512),[[U,n.value.full_name]])]),e("div",xe,[t[35]||(t[35]=e("label",{class:"form-label"},"Email",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>n.value.email=l),type:"email",class:"form-input",placeholder:"Enter email",disabled:""},null,512),[[U,n.value.email]])]),e("div",_e,[t[37]||(t[37]=e("label",{class:"form-label"},"Role",-1)),p(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>n.value.role=l),class:"form-input"},[...t[36]||(t[36]=[e("option",{value:"guest"},"Guest",-1),e("option",{value:"host"},"Host",-1),e("option",{value:"admin"},"Admin",-1)])],512),[[$,n.value.role]])])]),e("div",Ae,[e("button",{onClick:t[7]||(t[7]=l=>v.value=!1),class:"btn-cancel"},"Cancel"),e("button",{onClick:L,class:"btn-save"},"Save Changes")])])])):C("",!0),m.value?(d(),r("div",{key:4,class:"modal-overlay",onClick:t[13]||(t[13]=l=>m.value=!1)},[e("div",{class:"modal",onClick:t[12]||(t[12]=j(()=>{},["stop"]))},[e("div",Be,[t[39]||(t[39]=e("h3",null,"Delete User",-1)),e("button",{onClick:t[10]||(t[10]=l=>m.value=!1),class:"modal-close"},[...t[38]||(t[38]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",$e,[e("p",null,[t[40]||(t[40]=M("Are you sure you want to delete ",-1)),e("strong",null,a((u=c.value)==null?void 0:u.full_name),1),t[41]||(t[41]=M("?",-1))]),t[42]||(t[42]=e("p",{class:"warning-text"},"This action cannot be undone.",-1))]),e("div",je,[e("button",{onClick:t[11]||(t[11]=l=>m.value=!1),class:"btn-cancel"},"Cancel"),e("button",{onClick:H,class:"btn-confirm-delete"},"Delete User")])])])):C("",!0)])}}},Fe=S(ze,[["__scopeId","data-v-3228b5c3"]]);export{Fe as default};
